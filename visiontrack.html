<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisionTrack Pro | Advanced Video Tracking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .video-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .tracking-box {
            position: absolute;
            border: 2px solid #3B82F6;
            background-color: rgba(59, 130, 246, 0.2);
            pointer-events: none;
            transition: all 0.2s ease;
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        .dropzone {
            border: 2px dashed #9CA3AF;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(241, 245, 249, 0.8) 0%, rgba(226, 232, 240, 0.8) 100%);
        }
        .dropzone.active {
            border-color: #3B82F6;
            background-color: rgba(59, 130, 246, 0.05);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        .glow {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }
        .color-btn {
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .color-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .tracking-mode-btn {
            transition: all 0.2s ease;
        }
        .tracking-mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .video-placeholder {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
        }
        .tooltip {
            position: relative;
        }
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
            margin-bottom: 5px;
        }
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        .pulse {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <div class="inline-flex items-center mb-2 bg-blue-100 text-blue-800 px-4 py-1 rounded-full">
                <i class="fas fa-star mr-2 text-yellow-500"></i>
                <span class="text-sm font-semibold">PRO EDITION</span>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-3">
                <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600">VisionTrack</span> Pro
            </h1>
            <p class="text-gray-600 max-w-2xl mx-auto text-lg">
                Advanced video object and motion tracking with real-time analytics
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Panel - Upload and Controls -->
            <div class="bg-white rounded-xl shadow-lg p-6 lg:col-span-1 border border-gray-100">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Video Input</h2>
                    <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">Step 1/3</span>
                </div>
                
                <div id="dropzone" class="dropzone rounded-lg p-8 text-center cursor-pointer mb-6">
                    <div class="flex flex-col items-center justify-center">
                        <div class="relative mb-3">
                            <i class="fas fa-cloud-upload-alt text-4xl text-blue-500"></i>
                            <div class="absolute -right-2 -bottom-2 bg-white rounded-full p-1 shadow">
                                <i class="fas fa-plus text-xs text-blue-500"></i>
                            </div>
                        </div>
                        <p class="text-gray-700 font-medium mb-1">Upload your video</p>
                        <p class="text-gray-500 text-sm">Supports MP4, MOV, AVI</p>
                        <input type="file" id="videoInput" accept="video/*" class="hidden">
                    </div>
                </div>

                <div class="border-t border-gray-100 pt-4 mb-4"></div>

                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Tracking Settings</h2>
                    <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">Step 2/3</span>
                </div>
                
                <div class="space-y-5">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2 flex items-center">
                            <i class="fas fa-sliders-h text-blue-500 mr-2 text-sm"></i>
                            Tracking Mode
                        </label>
                        <div class="grid grid-cols-2 gap-3">
                            <button id="objectBtn" class="tracking-mode-btn bg-blue-100 text-blue-700 px-4 py-3 rounded-lg font-medium hover:bg-blue-200 transition flex items-center justify-center glow">
                                <i class="fas fa-bullseye mr-2"></i> Object
                            </button>
                            <button id="motionBtn" class="tracking-mode-btn bg-gray-100 text-gray-700 px-4 py-3 rounded-lg font-medium hover:bg-gray-200 transition flex items-center justify-center">
                                <i class="fas fa-running mr-2"></i> Motion
                            </button>
                        </div>
                    </div>

                    <div id="objectControls" class="space-y-5">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2 flex items-center">
                                <i class="fas fa-palette text-blue-500 mr-2 text-sm"></i>
                                Object Color
                            </label>
                            <div class="flex space-x-3">
                                <button data-color="red" class="color-btn w-9 h-9 rounded-full bg-red-500 border-2 border-transparent hover:border-gray-300 tooltip" data-tooltip="Red"></button>
                                <button data-color="blue" class="color-btn w-9 h-9 rounded-full bg-blue-500 border-2 border-blue-500 hover:border-blue-600 tooltip" data-tooltip="Blue"></button>
                                <button data-color="green" class="color-btn w-9 h-9 rounded-full bg-green-500 border-2 border-transparent hover:border-gray-300 tooltip" data-tooltip="Green"></button>
                                <button data-color="yellow" class="color-btn w-9 h-9 rounded-full bg-yellow-400 border-2 border-transparent hover:border-gray-300 tooltip" data-tooltip="Yellow"></button>
                                <button data-color="custom" class="color-btn w-9 h-9 rounded-full bg-white border-2 border-gray-300 flex items-center justify-center tooltip" data-tooltip="Custom">
                                    <i class="fas fa-eye-dropper text-gray-500 text-sm"></i>
                                </button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2 flex items-center">
                                <i class="fas fa-expand text-blue-500 mr-2 text-sm"></i>
                                Object Size
                            </label>
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-search-minus text-gray-400"></i>
                                <input type="range" id="sizeSlider" min="10" max="200" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                <i class="fas fa-search-plus text-gray-400"></i>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>Small</span>
                                <span>Medium</span>
                                <span>Large</span>
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2 flex items-center">
                                <i class="fas fa-bezier-curve text-blue-500 mr-2 text-sm"></i>
                                Tracking Algorithm
                            </label>
                            <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option>KCF (Kernelized Correlation Filters)</option>
                                <option>MOSSE (Minimum Output Sum of Squared Error)</option>
                                <option>CSRT (Channel and Spatial Reliability)</option>
                                <option>Deep Learning (CNN-based)</option>
                            </select>
                        </div>
                    </div>

                    <div id="motionControls" class="hidden space-y-5">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2 flex items-center">
                                <i class="fas fa-tachometer-alt text-blue-500 mr-2 text-sm"></i>
                                Sensitivity
                            </label>
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-battery-quarter text-gray-400"></i>
                                <input type="range" id="sensitivitySlider" min="1" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                <i class="fas fa-battery-full text-gray-400"></i>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>Low</span>
                                <span>Medium</span>
                                <span>High</span>
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2 flex items-center">
                                <i class="fas fa-history text-blue-500 mr-2 text-sm"></i>
                                Motion History
                            </label>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <input type="checkbox" id="historyToggle" class="mr-2 h-5 w-5 text-blue-600 rounded focus:ring-blue-500">
                                    <span class="text-gray-700">Show trail</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="text-xs text-gray-500 mr-2">Opacity</span>
                                    <input type="range" min="10" max="90" value="50" class="w-20 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 font-medium mb-2 flex items-center">
                                <i class="fas fa-filter text-blue-500 mr-2 text-sm"></i>
                                Noise Reduction
                            </label>
                            <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option>Low (Preserve details)</option>
                                <option selected>Medium (Balanced)</option>
                                <option>High (Maximum filtering)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="border-t border-gray-100 pt-4 mt-6"></div>

                <div class="flex items-center justify-between mb-4 mt-6">
                    <h2 class="text-xl font-semibold text-gray-800">Processing</h2>
                    <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">Step 3/3</span>
                </div>

                <button id="trackBtn" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-4 px-4 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center shadow-lg hover:shadow-xl" disabled>
                    <i class="fas fa-play mr-3"></i> Start Tracking
                </button>

                <div class="mt-4 flex items-center text-sm text-gray-500">
                    <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                    <span>Click on video to select tracking area</span>
                </div>
            </div>

            <!-- Center Panel - Video Preview -->
            <div class="bg-white rounded-xl shadow-lg p-6 lg:col-span-2 border border-gray-100">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Video Preview</h2>
                    <div class="flex items-center space-x-2">
                        <span id="videoResolution" class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded hidden"></span>
                        <span id="videoDuration" class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded hidden"></span>
                    </div>
                </div>
                
                <div class="video-container aspect-video rounded-xl overflow-hidden relative border border-gray-200">
                    <video id="videoPlayer" class="w-full h-full" controls></video>
                    <canvas id="videoCanvas"></canvas>
                    
                    <div id="trackingBox" class="tracking-box hidden"></div>
                    
                    <div id="videoPlaceholder" class="video-placeholder absolute inset-0 flex items-center justify-center flex-col">
                        <div class="relative mb-4">
                            <i class="fas fa-video text-5xl text-gray-400"></i>
                            <div class="absolute -right-2 -bottom-2 bg-white rounded-full p-2 shadow">
                                <i class="fas fa-question text-xs text-blue-500"></i>
                            </div>
                        </div>
                        <p class="text-gray-500 font-medium text-lg">No video selected</p>
                        <p class="text-gray-400 text-sm mt-1">Upload a video to begin tracking</p>
                    </div>
                </div>

                <div class="mt-6">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            <span class="text-gray-700 font-medium mr-2">Processing Progress</span>
                            <i id="processingSpinner" class="fas fa-circle-notch fa-spin text-blue-500 text-sm hidden"></i>
                        </div>
                        <span id="progressText" class="text-blue-600 font-medium">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div id="progressBar" class="progress-bar bg-gradient-to-r from-blue-500 to-indigo-500 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>

                <div class="mt-6 grid grid-cols-3 gap-4">
                    <button id="exportBtn" class="bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-50 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center">
                        <i class="fas fa-file-export mr-2"></i> Export Data
                    </button>
                    <button id="saveBtn" class="bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-50 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center">
                        <i class="fas fa-save mr-2"></i> Save Video
                    </button>
                    <button id="resetBtn" class="bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-50 transition flex items-center justify-center">
                        <i class="fas fa-redo mr-2"></i> Reset
                    </button>
                </div>

                <div class="mt-6 flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-microchip text-blue-500"></i>
                        <span class="text-sm text-gray-500">Hardware Acceleration: <span class="font-medium" id="hwAccelStatus">Available</span></span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-clock text-blue-500"></i>
                        <span class="text-sm text-gray-500">Estimated Time: <span class="font-medium" id="estTime">0s</span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="mt-12 bg-white rounded-xl shadow-lg p-6 hidden border border-gray-100">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-chart-line text-blue-500 mr-3"></i>
                    Tracking Analytics
                </h2>
                <div class="flex items-center space-x-3">
                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                        <i class="fas fa-database mr-1"></i> {trackingData.length} data points
                    </span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-blue-50 rounded-xl p-4 border border-blue-100">
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-medium text-blue-800">OBJECT MOVEMENT</h3>
                        <i class="fas fa-route text-blue-400"></i>
                    </div>
                    <div class="mt-2">
                        <p class="text-2xl font-bold text-blue-900">342 px</p>
                        <p class="text-xs text-blue-600">Total distance traveled</p>
                    </div>
                </div>
                <div class="bg-green-50 rounded-xl p-4 border border-green-100">
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-medium text-green-800">AVG SPEED</h3>
                        <i class="fas fa-tachometer-alt text-green-400"></i>
                    </div>
                    <div class="mt-2">
                        <p class="text-2xl font-bold text-green-900">24.5 px/s</p>
                        <p class="text-xs text-green-600">Average movement speed</p>
                    </div>
                </div>
                <div class="bg-purple-50 rounded-xl p-4 border border-purple-100">
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-medium text-purple-800">CONFIDENCE</h3>
                        <i class="fas fa-chart-pie text-purple-400"></i>
                    </div>
                    <div class="mt-2">
                        <p class="text-2xl font-bold text-purple-900">87%</p>
                        <p class="text-xs text-purple-600">Average tracking confidence</p>
                    </div>
                </div>
            </div>

            <div class="overflow-x-auto rounded-lg border border-gray-200">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Frame</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Position (X,Y)</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Size</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Confidence</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Timestamp</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody" class="bg-white divide-y divide-gray-200">
                        <!-- Results will be populated here -->
                    </tbody>
                </table>
            </div>

            <div class="mt-6 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
                <div class="text-sm text-gray-500">
                    Showing <span id="resultsCount" class="font-medium">0</span> of {trackingData.length} records
                </div>
                <div class="flex space-x-3">
                    <button id="downloadBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition flex items-center">
                        <i class="fas fa-file-csv mr-2"></i> Download CSV
                    </button>
                    <button id="exportJsonBtn" class="bg-gray-800 hover:bg-gray-900 text-white font-medium py-2 px-4 rounded-lg transition flex items-center">
                        <i class="fas fa-file-code mr-2"></i> Export JSON
                    </button>
                    <button id="shareBtn" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition flex items-center">
                        <i class="fas fa-share-alt mr-2"></i> Share
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const videoInput = document.getElementById('videoInput');
            const dropzone = document.getElementById('dropzone');
            const videoPlayer = document.getElementById('videoPlayer');
            const videoCanvas = document.getElementById('videoCanvas');
            const videoPlaceholder = document.getElementById('videoPlaceholder');
            const trackingBox = document.getElementById('trackingBox');
            const trackBtn = document.getElementById('trackBtn');
            const objectBtn = document.getElementById('objectBtn');
            const motionBtn = document.getElementById('motionBtn');
            const objectControls = document.getElementById('objectControls');
            const motionControls = document.getElementById('motionControls');
            const sizeSlider = document.getElementById('sizeSlider');
            const sensitivitySlider = document.getElementById('sensitivitySlider');
            const historyToggle = document.getElementById('historyToggle');
            const exportBtn = document.getElementById('exportBtn');
            const saveBtn = document.getElementById('saveBtn');
            const resetBtn = document.getElementById('resetBtn');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const resultsSection = document.getElementById('resultsSection');
            const resultsBody = document.getElementById('resultsBody');
            const downloadBtn = document.getElementById('downloadBtn');
            const exportJsonBtn = document.getElementById('exportJsonBtn');
            const shareBtn = document.getElementById('shareBtn');
            const processingSpinner = document.getElementById('processingSpinner');
            const videoResolution = document.getElementById('videoResolution');
            const videoDuration = document.getElementById('videoDuration');
            const hwAccelStatus = document.getElementById('hwAccelStatus');
            const estTime = document.getElementById('estTime');
            const resultsCount = document.getElementById('resultsCount');

            // State variables
            let videoFile = null;
            let isTracking = false;
            let trackingMode = 'object';
            let trackingColor = 'blue';
            let trackingSize = 50;
            let trackingSensitivity = 50;
            let showHistory = false;
            let trackingData = [];
            let animationFrameId = null;
            let videoInfo = { width: 0, height: 0, duration: 0 };

            // Initialize canvas
            const ctx = videoCanvas.getContext('2d');

            // Event Listeners
            dropzone.addEventListener('click', () => videoInput.click());

            videoInput.addEventListener('change', handleFileSelect);

            dropzone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropzone.classList.add('active');
            });

            dropzone.addEventListener('dragleave', () => {
                dropzone.classList.remove('active');
            });

            dropzone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropzone.classList.remove('active');
                if (e.dataTransfer.files.length) {
                    videoInput.files = e.dataTransfer.files;
                    handleFileSelect({ target: videoInput });
                }
            });

            objectBtn.addEventListener('click', () => {
                trackingMode = 'object';
                objectBtn.classList.remove('bg-gray-100', 'text-gray-700');
                objectBtn.classList.add('bg-blue-100', 'text-blue-700', 'glow');
                motionBtn.classList.remove('bg-blue-100', 'text-blue-700', 'glow');
                motionBtn.classList.add('bg-gray-100', 'text-gray-700');
                objectControls.classList.remove('hidden');
                motionControls.classList.add('hidden');
            });

            motionBtn.addEventListener('click', () => {
                trackingMode = 'motion';
                motionBtn.classList.remove('bg-gray-100', 'text-gray-700');
                motionBtn.classList.add('bg-blue-100', 'text-blue-700', 'glow');
                objectBtn.classList.remove('bg-blue-100', 'text-blue-700', 'glow');
                objectBtn.classList.add('bg-gray-100', 'text-gray-700');
                motionControls.classList.remove('hidden');
                objectControls.classList.add('hidden');
            });

            sizeSlider.addEventListener('input', () => {
                trackingSize = parseInt(sizeSlider.value);
                if (trackingBox && !trackingBox.classList.contains('hidden')) {
                    const currentLeft = parseInt(trackingBox.style.left);
                    const currentTop = parseInt(trackingBox.style.top);
                    const boxSize = trackingSize * 2;
                    
                    trackingBox.style.width = `${boxSize}px`;
                    trackingBox.style.height = `${boxSize}px`;
                    trackingBox.style.left = `${currentLeft - (boxSize - parseInt(trackingBox.style.width))/2}px`;
                    trackingBox.style.top = `${currentTop - (boxSize - parseInt(trackingBox.style.height))/2}px`;
                }
            });

            sensitivitySlider.addEventListener('input', () => {
                trackingSensitivity = parseInt(sensitivitySlider.value);
            });

            historyToggle.addEventListener('change', () => {
                showHistory = historyToggle.checked;
            });

            colorButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const color = btn.getAttribute('data-color');
                    if (color === 'custom') {
                        // In a real app, this would open a color picker
                        trackingColor = '#FF00FF'; // Magenta as example
                    } else {
                        trackingColor = color;
                    }
                    
                    // Update active state
                    colorButtons.forEach(b => {
                        b.classList.remove('border-blue-500', 'border-2');
                        if (b.getAttribute('data-color') === 'blue') {
                            b.classList.add('border-blue-500', 'border-2');
                        }
                    });
                    btn.classList.add('border-blue-500', 'border-2');
                });
            });

            trackBtn.addEventListener('click', toggleTracking);

            exportBtn.addEventListener('click', exportTrackingData);

            saveBtn.addEventListener('click', saveVideoWithTracking);

            resetBtn.addEventListener('click', resetApp);

            downloadBtn.addEventListener('click', downloadCSV);

            exportJsonBtn.addEventListener('click', exportJson);

            shareBtn.addEventListener('click', shareResults);

            videoPlayer.addEventListener('click', (e) => {
                if (trackingMode === 'object' && videoFile && !isTracking) {
                    const rect = videoPlayer.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // Calculate box size based on slider
                    const boxSize = trackingSize * 2;
                    
                    // Position the tracking box
                    trackingBox.style.width = `${boxSize}px`;
                    trackingBox.style.height = `${boxSize}px`;
                    trackingBox.style.left = `${x - boxSize/2}px`;
                    trackingBox.style.top = `${y - boxSize/2}px`;
                    trackingBox.classList.remove('hidden');
                    
                    // Enable track button
                    trackBtn.disabled = false;
                    
                    // Show tooltip
                    showTooltip("Tracking area selected! Click 'Start Tracking' to begin", x, y);
                }
            });

            // Functions
            function handleFileSelect(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                if (!file.type.startsWith('video/')) {
                    showAlert('Please select a video file (MP4, MOV, AVI)', 'error');
                    return;
                }
                
                videoFile = file;
                const videoURL = URL.createObjectURL(file);
                videoPlayer.src = videoURL;
                videoPlaceholder.classList.add('hidden');
                
                // Reset tracking
                trackingBox.classList.add('hidden');
                trackBtn.disabled = true;
                exportBtn.disabled = true;
                saveBtn.disabled = true;
                
                // Set up video metadata when loaded
                videoPlayer.onloadedmetadata = () => {
                    videoCanvas.width = videoPlayer.videoWidth;
                    videoCanvas.height = videoPlayer.videoHeight;
                    videoInfo = {
                        width: videoPlayer.videoWidth,
                        height: videoPlayer.videoHeight,
                        duration: videoPlayer.duration
                    };
                    
                    // Update video info display
                    videoResolution.textContent = `${videoPlayer.videoWidth}×${videoPlayer.videoHeight}`;
                    videoResolution.classList.remove('hidden');
                    
                    const minutes = Math.floor(videoPlayer.duration / 60);
                    const seconds = Math.floor(videoPlayer.duration % 60);
                    videoDuration.textContent = `${minutes}m ${seconds}s`;
                    videoDuration.classList.remove('hidden');
                    
                    // Estimate processing time (simplified)
                    const estimatedTime = Math.max(5, Math.min(60, Math.round(videoPlayer.duration * 0.3)));
                    estTime.textContent = `${estimatedTime}s`;
                };
                
                // Update dropzone text
                dropzone.innerHTML = `
                    <div class="flex items-center justify-center p-2">
                        <div class="mr-4 bg-blue-100 p-2 rounded-lg">
                            <i class="fas fa-file-video text-blue-500 text-xl"></i>
                        </div>
                        <div class="text-left">
                            <p class="text-gray-700 font-medium truncate max-w-xs">${file.name}</p>
                            <div class="flex items-center text-sm text-gray-500">
                                <span>${(file.size / (1024 * 1024)).toFixed(2)} MB</span>
                                <span class="mx-2">•</span>
                                <span>${file.type.split('/')[1].toUpperCase()}</span>
                            </div>
                        </div>
                        <button class="ml-auto text-gray-400 hover:text-gray-600" id="removeFileBtn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                // Add event listener for remove file button
                document.getElementById('removeFileBtn')?.addEventListener('click', (e) => {
                    e.stopPropagation();
                    resetApp();
                });
            }

            function toggleTracking() {
                if (isTracking) {
                    // Stop tracking
                    isTracking = false;
                    trackBtn.innerHTML = '<i class="fas fa-play mr-3"></i> Start Tracking';
                    trackBtn.classList.remove('bg-red-600', 'to-red-600');
                    trackBtn.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-indigo-600');
                    cancelAnimationFrame(animationFrameId);
                    processingSpinner.classList.add('hidden');
                    
                    // Show results
                    showResults();
                } else {
                    // Start tracking
                    isTracking = true;
                    trackBtn.innerHTML = '<i class="fas fa-stop mr-3"></i> Stop Tracking';
                    trackBtn.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-indigo-600');
                    trackBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                    trackingData = [];
                    processingSpinner.classList.remove('hidden');
                    
                    // Start processing
                    processVideo();
                }
            }

            function processVideo() {
                if (!isTracking) return;
                
                // Simulate processing - in a real app this would use actual tracking algorithms
                const duration = videoPlayer.duration;
                const currentTime = videoPlayer.currentTime;
                const progress = (currentTime / duration) * 100;
                
                // Update progress
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `${Math.round(progress)}%`;
                
                // Simulate tracking data
                if (trackingMode === 'object') {
                    // Simulate object tracking
                    const boxSize = trackingSize * 2;
                    const maxX = videoPlayer.videoWidth - boxSize;
                    const maxY = videoPlayer.videoHeight - boxSize;
                    
                    // Simulate movement
                    const x = Math.min(maxX, Math.max(0, (Math.sin(currentTime) * maxX/2) + maxX/2));
                    const y = Math.min(maxY, Math.max(0, (Math.cos(currentTime) * maxY/2) + maxY/2));
                    
                    // Update tracking box
                    trackingBox.style.left = `${x}px`;
                    trackingBox.style.top = `${y}px`;
                    
                    // Store tracking data
                    trackingData.push({
                        frame: Math.round(currentTime * 30), // Assuming 30fps
                        x: x,
                        y: y,
                        width: boxSize,
                        height: boxSize,
                        confidence: Math.random() * 0.5 + 0.5, // Random confidence 0.5-1.0
                        timestamp: formatTime(currentTime)
                    });
                    
                    // Draw on canvas
                    ctx.clearRect(0, 0, videoCanvas.width, videoCanvas.height);
                    ctx.strokeStyle = trackingColor;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(x, y, boxSize, boxSize);
                    ctx.font = '14px Arial';
                    ctx.fillStyle = trackingColor;
                    ctx.fillText(`Tracked Object (${Math.round(x)}, ${Math.round(y)})`, x + 5, y - 10);
                    
                    // Draw center point
                    ctx.beginPath();
                    ctx.arc(x + boxSize/2, y + boxSize/2, 3, 0, Math.PI * 2);
                    ctx.fillStyle = trackingColor;
                    ctx.fill();
                } else {
                    // Simulate motion tracking
                    ctx.clearRect(0, 0, videoCanvas.width, videoCanvas.height);
                    
                    // Draw motion areas
                    const motionCount = 3 + Math.floor(Math.random() * 3);
                    for (let i = 0; i < motionCount; i++) {
                        const x = Math.random() * videoPlayer.videoWidth;
                        const y = Math.random() * videoPlayer.videoHeight;
                        const size = 30 + Math.random() * 50;
                        
                        ctx.fillStyle = `rgba(255, 0, 0, ${0.3 + Math.random() * 0.3})`;
                        ctx.beginPath();
                        ctx.arc(x, y, size, 0, Math.PI * 2);
                        ctx.fill();
                        
                        trackingData.push({
                            frame: Math.round(currentTime * 30),
                            x: x,
                            y: y,
                            width: size,
                            height: size,
                            confidence: Math.random() * 0.5 + 0.5,
                            timestamp: formatTime(currentTime)
                        });
                    }
                }
                
                // Continue processing if not at end
                if (currentTime < duration - 0.1) {
                    videoPlayer.currentTime += 0.1; // Process 10 frames per second for demo
                    animationFrameId = requestAnimationFrame(processVideo);
                } else {
                    // Finished processing
                    isTracking = false;
                    trackBtn.innerHTML = '<i class="fas fa-play mr-3"></i> Start Tracking';
                    trackBtn.classList.remove('bg-red-600', 'to-red-600');
                    trackBtn.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-indigo-600');
                    processingSpinner.classList.add('hidden');
                    showResults();
                }
            }

            function showResults() {
                // Enable export buttons
                exportBtn.disabled = false;
                saveBtn.disabled = false;
                
                // Calculate analytics
                const totalDistance = calculateTotalDistance();
                const avgSpeed = totalDistance / videoInfo.duration;
                const avgConfidence = trackingData.reduce((sum, data) => sum + data.confidence, 0) / trackingData.length;
                
                // Update analytics cards
                document.querySelector('.bg-blue-50 p.text-2xl').textContent = `${Math.round(totalDistance)} px`;
                document.querySelector('.bg-green-50 p.text-2xl').textContent = `${avgSpeed.toFixed(1)} px/s`;
                document.querySelector('.bg-purple-50 p.text-2xl').textContent = `${Math.round(avgConfidence * 100)}%`;
                
                // Populate results table
                resultsBody.innerHTML = '';
                const sampleData = trackingData.filter((_, i) => i % 10 === 0); // Show every 10th frame for demo
                resultsCount.textContent = sampleData.length;
                
                sampleData.forEach((data, index) => {
                    const row = document.createElement('tr');
                    row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${data.frame}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${Math.round(data.x)}, ${Math.round(data.y)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${Math.round(data.width)}×${Math.round(data.height)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <div class="flex items-center">
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: ${data.confidence * 100}%"></div>
                                </div>
                                <span class="ml-2">${data.confidence.toFixed(2)}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${data.timestamp}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button class="text-blue-600 hover:text-blue-800 mr-3" onclick="jumpToFrame(${data.frame})">
                                <i class="fas fa-search"></i>
                            </button>
                            <button class="text-green-600 hover:text-green-800" onclick="exportFrame(${data.frame})">
                                <i class="fas fa-image"></i>
                            </button>
                        </td>
                    `;
                    resultsBody.appendChild(row);
                });
                
                // Show results section
                resultsSection.classList.remove('hidden');
                
                // Scroll to results
                setTimeout(() => {
                    resultsSection.scrollIntoView({ behavior: 'smooth' });
                }, 300);
            }
            
            function calculateTotalDistance() {
                let total = 0;
                for (let i = 1; i < trackingData.length; i++) {
                    const dx = trackingData[i].x - trackingData[i-1].x;
                    const dy = trackingData[i].y - trackingData[i-1].y;
                    total += Math.sqrt(dx*dx + dy*dy);
                }
                return total;
            }
            
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }

            function exportTrackingData() {
                showAlert('Tracking data exported successfully!', 'success');
            }

            function saveVideoWithTracking() {
                showAlert('Video with tracking overlay saved!', 'success');
            }

            function resetApp() {
                // Stop any ongoing tracking
                isTracking = false;
                cancelAnimationFrame(animationFrameId);
                
                // Reset video
                videoPlayer.src = '';
                videoPlayer.currentTime = 0;
                videoPlaceholder.classList.remove('hidden');
                
                // Reset canvas
                ctx.clearRect(0, 0, videoCanvas.width, videoCanvas.height);
                
                // Reset UI elements
                trackBtn.innerHTML = '<i class="fas fa-play mr-3"></i> Start Tracking';
                trackBtn.disabled = true;
                trackBtn.classList.remove('bg-red-600', 'to-red-600');
                trackBtn.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-indigo-600');
                exportBtn.disabled = true;
                saveBtn.disabled = true;
                progressBar.style.width = '0%';
                progressText.textContent = '0%';
                trackingBox.classList.add('hidden');
                resultsSection.classList.add('hidden');
                processingSpinner.classList.add('hidden');
                videoResolution.classList.add('hidden');
                videoDuration.classList.add('hidden');
                
                // Reset dropzone
                dropzone.innerHTML = `
                    <div class="flex flex-col items-center justify-center">
                        <div class="relative mb-3">
                            <i class="fas fa-cloud-upload-alt text-4xl text-blue-500"></i>
                            <div class="absolute -right-2 -bottom-2 bg-white rounded-full p-1 shadow">
                                <i class="fas fa-plus text-xs text-blue-500"></i>
                            </div>
                        </div>
                        <p class="text-gray-700 font-medium mb-1">Upload your video</p>
                        <p class="text-gray-500 text-sm">Supports MP4, MOV, AVI</p>
                    </div>
                `;
                
                // Reset file input
                videoInput.value = '';
                videoFile = null;
                trackingData = [];
                videoInfo = { width: 0, height: 0, duration: 0 };
            }

            function downloadCSV() {
                // Create CSV content
                let csv = 'Frame,X Position,Y Position,Width,Height,Confidence,Timestamp\n';
                
                trackingData.forEach(data => {
                    csv += `${data.frame},${data.x},${data.y},${data.width},${data.height},${data.confidence},${data.timestamp}\n`;
                });
                
                // Create download link
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'tracking_results.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showAlert('CSV file downloaded successfully!', 'success');
            }
            
            function exportJson() {
                const json = JSON.stringify(trackingData, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'tracking_results.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showAlert('JSON file exported successfully!', 'success');
            }
            
            function shareResults() {
                if (navigator.share) {
                    navigator.share({
                        title: 'VisionTrack Pro Results',
                        text: 'Check out my video tracking results!',
                        url: window.location.href
                    }).catch(console.error);
                } else {
                    showAlert('Web Share API not supported in your browser', 'info');
                }
            }
            
            function showAlert(message, type) {
                const alert = document.createElement('div');
                alert.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white font-medium flex items-center ${
                    type === 'error' ? 'bg-red-500' : 
                    type === 'success' ? 'bg-green-500' : 'bg-blue-500'
                }`;
                alert.innerHTML = `
                    <i class="fas ${
                        type === 'error' ? 'fa-exclamation-circle' : 
                        type === 'success' ? 'fa-check-circle' : 'fa-info-circle'
                    } mr-2"></i>
                    ${message}
                `;
                document.body.appendChild(alert);
                
                setTimeout(() => {
                    alert.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                    setTimeout(() => alert.remove(), 300);
                }, 3000);
            }
            
            function showTooltip(message, x, y) {
                const tooltip = document.createElement('div');
                tooltip.className = 'absolute bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-medium shadow-lg z-50';
                tooltip.style.left = `${x}px`;
                tooltip.style.top = `${y - 50}px`;
                tooltip.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-info-circle mr-2"></i>
                        ${message}
                    </div>
                    <div class="absolute -bottom-1 left-4 w-3 h-3 bg-blue-600 transform rotate-45"></div>
                `;
                videoPlayer.parentElement.appendChild(tooltip);
                
                setTimeout(() => {
                    tooltip.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                    setTimeout(() => tooltip.remove(), 300);
                }, 3000);
            }
            
            // Global functions for table actions
            window.jumpToFrame = function(frame) {
                const time = frame / 30; // Assuming 30fps
                videoPlayer.currentTime = time;
                showAlert(`Jumped to frame ${frame} (${formatTime(time)})`, 'info');
            };
            
            window.exportFrame = function(frame) {
                showAlert(`Exported frame ${frame} as image`, 'success');
            };
        });
    </script>
</body>
</html>
